var MIN_ANNOTATION_LENGTH=1,targetSpace='\x3cspan class\x3d"target"\x3e \x3c/span\x3e',symbolBarLoaded=!1,studentView=!0,essaySelector=".itemResponse td.essay",annotatedSelector='input[name^\x3d"annotated"]',editKeywordTable=null,historyWindow;
function showGrades(){var a;try{a=parseInt($("select[name\x3dgradingStyle]").val())}catch(b){a=0}switch(a){case 2:$(".grade-numeric").hide();$(".grade-percent").hide();$(".grade-letter").show();break;case 1:$(".grade-numeric").hide();$(".grade-percent").show();$(".grade-letter").hide();break;default:$(".grade-numeric").show(),$(".grade-percent").hide(),$(".grade-letter").hide()}}
function showSymbolBar(){if(0<$(essaySelector).length){var a=0<$("#symbolBar").length;if(!symbolBarLoaded){$("#symbolBar").removeClass("hide");setBarSize();$(window).on("resize",function(){setBarSize()});$("#symbolBar .closeBar").off().on("click",toggleSymbolBar);$("#symbolBar.closed").off().on("click",function(){$("#symbolBar").hasClass("closed")&&toggleSymbolBar()});$("#addSymbol a").off().on("click",function(){var a=getBaseURL()+"rest/essaysymbols",b=$("#symbolName").val(),e=$("#description").val();
0<b.length&&$.ajax({type:"POST",url:a,contentType:"application/json",dataType:"json",data:JSON.stringify({symbol:b,description:e}),success:function(a){$("#symbolName").val("");$("#description").val("");loadSymbols()}});return!1});loadSymbols();var b=$("#instruction").html();$("#symbols").on("mouseout",function(){$("#instruction").html(b);$("#instruction").removeClass("description");$("#symbols li").removeClass("notation")})}a&&createTargets();a&&($(".notation").draggable(notationDraggable),$(".notation").addClass("draggable"),
$(essaySelector+" .target").off().droppable({tolerance:"pointer",hoverClass:"hoveringTarget",drop:function(a,b){var e=$(b.draggable).data("description"),e=$('\x3cspan class\x3d"notation" title\x3d"'+e+'"\x3e'+$(b.draggable).html()+"\x3c/span\x3e");$(b.draggable).hasClass("notation")&&$(b.draggable).remove();$(a.target).after(e);$(e).draggable(notationDraggable);e=$(this).parents(essaySelector);essayAnnotated(e)}}),$("#remove").droppable({tolerance:"touch",hoverClass:"hovering",drop:function(a,b){if($(b.draggable).hasClass("notation")){var e=
$(b.draggable).parents(essaySelector);$(b.draggable).remove();essayAnnotated(e)}else if($(b.draggable).hasClass("symbol")){var e=$(b.draggable).html(),f=$(b.draggable).data("id");$.ajax({type:"DELETE",url:getBaseURL()+"rest/essaysymbols",contentType:"application/json",dataType:"json",data:JSON.stringify({symbol:e,id:f}),success:function(){$(b.draggable).remove()}})}}}),$("#addSymbol .addSymbolSpan").off().on("click",function(){$("#addSymbol").toggleClass("closed open");$("#addSymbol .openSymbol").toggleClass("hidden");
$("#addSymbol .closeSymbol").toggleClass("hidden");setBarSize()}),symbolBarLoaded=!0)}}
var cleanupEssay=function(a){$("#cleaned").html($(a).html());removeMathJax($("#cleaned"));_.each($("#cleaned span.target"),function(a){var c=$(a).html();$(a).replaceWith(c)});_.each($("#cleaned span.notation"),function(a){var c=$(a).attr("title");if(null==c||0==c.length)c=$(a).data("original-title");var d=$(a).text();$(a).replaceWith("{\x3e\x3e"+d+"|"+c+"\x3c\x3c}")});return $("#cleaned").html().replace(/&lt;/g,"\x3c").replace(/&gt;/g,"\x3e")};
function replaceMath(){var a=$(".essay",$(this)),b=$(a).html(),c=/((\\\([ -~\r\n]*?\\\)))/g,d=/((\\\[[ -~\r\n]*?\\\]))/g,b=b.replace(/(<math[^>]*?>[\S\s]*?<\/math>)/g,function(a){return a.match(c)||a.match(d)?a:'\x3cspan class\x3d"essayMathjax" source\x3d"'+encodeURIComponent(a)+'"\x3e'+a+"\x3c/span\x3e"}),b=b.replace(c,function(a){return'\x3cspan class\x3d"essayMathjax" source\x3d"'+encodeURIComponent(a)+'"\x3e'+a+"\x3c/span\x3e"}),b=b.replace(d,function(a){return'\x3cdiv class\x3d"essayMathjax" source\x3d"'+
encodeURIComponent(a)+'"\x3e'+a+"\x3c/div\x3e"});$(a).html(b)}function preProcessMathForEssay(a){a=a?a:document;$(".itemResponse .essayresponse",$(a)).each(replaceMath);$(".itemResponse .oldessayresponse",$(a)).each(replaceMath)}function removeMathJax(a){$(".essayMathjax",$(a)).each(function(){var a=decodeURIComponent($(this).attr("source"));$(this).replaceWith(a)});$("[class*\x3d'MathJax'],[id*\x3d'MathJax']",$(a)).remove()}
var toggleSymbolBar=function(){$("#symbolBar").toggleClass("open closed");setBarSize();return!1},showRemove=function(){$("#symbolBar").hasClass("closed")&&toggleSymbolBar()},notationDrag=function(a,b){try{$(this).tooltip("hide")}catch(c){}dropped=!1;$(this).addClass("hide")},notationStop=function(){1==dropped?$(this).remove():$(this).removeClass("hide")},notationDraggable={addClasses:!1,revert:"invalid",helper:"clone",appendTo:"#dragHelper",start:notationDrag,stop:notationStop},replaceComments=function(){var a=
$(essaySelector);_.each(a,function(a){var c=$(a).html().replace(/\{&gt;&gt;([^\|]*?)\|([^<]*?)&lt;&lt;\}/g,function(a,b,c){return'\x3cspan class\x3d"notation" title\x3d"'+c+'" data-content\x3d"'+b+'"\x3e\x3c/span\x3e'});$(a).html(c)})},displayComments=function(){var a=$(essaySelector+" .notation");_.each(a,function(a){var c=$(a).attr("data-content");$(a).html(c)})},removeTargets=function(){var a=$(essaySelector);_.each(a,function(a){$(a).html();_.each($("span.target",$(a)),function(a){var b=$(a).html();
$(a).replaceWith(b)})})},createTargets=function(){var a=$(essaySelector);_.each(a,function(a){$(".MathJax",$(a)).removeAttr("data-mathml");for(var c=$(a).html(),d=!0;1==d;)d=!1,c=c.replace(/<([^>]*) ([^>]*)>/g,function(a,b,c){d=!0;return"\x3c"+b+"-\x3d-"+c+"\x3e"});c=" "+c.replace(/(<[^>]*>)/g," $1 ")+" ";c=c.replace(/\s([a-zA-Z][^ ]*[a-zA-Z,;\.])/g,' \x3cspan class\x3d"target"\x3e$1\x3c/span\x3e');c=c.replace(/-=-/g," ");$(a).html(c);$("span.MathJax",$(a)).each(function(){var a=$(this).html(),a=
a.replace(/>\s+/g,"\x3e"),a=a.replace(/\s+</g,"\x3c");$(this).html(a)});a=$('script[id^\x3d"MathJax-Element-"]',$(a));_.each(a,function(a){var b=$(a).html(),b=b.replace(/>\s+/g,"\x3e"),b=b.replace(/\s+</g,"\x3c"),b=$("\x3cdiv\x3e").append(b),c=$(b).find("span.target");_.each(c,function(a){var b=$(a).html();$(a).replaceWith(b)});$(a).html($(b).html())})})},setBarSize=function(){var a=$("#symbolBar"),b=$("#top").height();$(a).css("top",b+10);$(a).show();if($(a).hasClass("open")){var b=20,c=$(a).height()-
$("h2",a).height()-$("#instructionHolder",a).height()-$("#addSymbol",a).height()-$("#removeArea",a).height()-15;$("#symbols",a).css("height",c)}else b=10,$(a).css("width","");$("#viewSearchForm").css("margin-left",$("#symbolBar").width()+b)},appendSymbol=function(a,b,c){a=$('\x3cli data-description\x3d"'+c+'" class\x3d"symbol" data-id\x3d"'+a+'"\x3e'+b+"\x3c/li\x3e");$("#symbols").append(a);$(a).draggable(notationDraggable);$(a).on("mouseover",function(){$("#symbolBar").hasClass("open")&&($("#instruction").html(c),
$("#instruction").addClass("description"),$("#symbolBar").css("width",201),setTimeout(function(){$("#symbolBar").css("width",200)},200))})},loadSymbols=function(){var a=getBaseURL()+"rest/essaysymbols";$("#symbols").html("");$.get(a,function(a){_.each(a,function(a){appendSymbol(a.id,a.symbol,a.description)})})};
function getSelectedText(){if(window.getSelection)return window.getSelection();if(document.getSelection)return document.getSelection();if(document.selection)return document.selection.createRange()}function removeElement(a){var b=$(a).html();$(a).replaceWith(b)}function removeAnnotation(a){var b=$(a).closest(".essay");removeElement(a);$("#annotation-custom-menu").hide();$("#annotation-custom-menu-edit").off("click");$("#annotation-custom-menu-remove").off("click");essayAnnotated(b)}
function removeHighlight(){var a=$(this).closest(".essay");removeElement(this);essayAnnotated(a)}function removeTmpspans(){$(".tmpspan").each(function(){removeElement(this)})}function addHighlight(a,b){$(b).addClass("highlight");$(b).removeClass("tmpspan");$(".highlight",a).off().on("click",removeHighlight);essayAnnotated(a)}
function addAnnotation(a,b){var c=$("#annotation-grade").val();if(isNaN(c))alert(msgInvalidAnnotationGrade),$("#annotation-grade").trigger("focus");else{var d=$("#annotation-comment").val(),c="\x3cspan class\x3d'essayAnnotation' data-grade\x3d'"+c+"' data-comment\x3d'"+d+"' title\x3d'"+(c+" : "+d)+"'\x3e"+$(b).html()+"\x3c/span\x3e";$(".notation, .essayAnnotation",$(essaySelector)).each(function(){var a=$(this).data()["bs.tooltip"];a&&a.$tip&&a.$tip.removeClass("fade");$(this).tooltip("destroy")});
$(b).replaceWith(c);$(".essayAnnotation",$(a)).off().on("click",annotationClicked);$("#addAnnotation .btn-default").off("click");$("#addAnnotation .btn-danger").off("click");$("#essay-custom-menu-highlight").off("click");$("#essay-custom-menu-annotation").off("click");$("#addAnnotation").modal("hide");essayAnnotated(a)}}
function annotationClicked(a){$("#annotation-custom-menu").show();$("#annotation-custom-menu").css("top",a.pageY+2+"px");$("#annotation-custom-menu").css("left",a.pageX+2+"px");var b=this;$("#annotation-custom-menu-edit").off().on("click",function(){editAnnotation(b)});$("#annotation-custom-menu-remove").off().on("click",function(){removeAnnotation(b)});return!1}
function saveAnnotation(a){var b=Number($("#annotation-grade").val());if(isNaN(b))alert(msgInvalidAnnotationGrade),$("#annotation-grade").trigger("focus");else{var c=$("#annotation-comment").val(),d=b+" : "+c;$(a).attr("data-grade",b);$(a).attr("data-comment",c);$(a).attr("data-original-title",d);$("#addAnnotation .btn-default").off("click");$("#annotation-custom-menu-edit").off("click");$("#annotation-custom-menu-remove").off("click");$("#addAnnotation").modal("hide");essayAnnotated($(a).closest(".essay"))}}
function editAnnotation(a){var b=$(a).attr("data-grade"),c=$(a).attr("data-comment");$("#annotation-grade").val(b);$("#annotation-comment").val(c);$("#addAnnotation").modal("show");$("#addAnnotation .btn-default").off().on("click",function(){saveAnnotation(a)});$("#annotation-custom-menu").hide();$("#annotation-custom-menu-edit").off("click");$("#annotation-custom-menu-remove").off("click")}
function createSpanOnContextMenu(a){a=a.getRangeAt(0);var b,c=a.commonAncestorContainer,d;d=document.createElement("span");$(d).addClass("tmpspan");if("essayMathjax"==c.className||0<$(c).closest(".essayMathjax").length)"essayMathjax"!=c.className&&(c=$(c).closest(".essayMathjax")),b=$("\x3cdiv\x3e").append($(c).clone()).html(),$(d).html(b),$(c).replaceWith(d);else{b=a.startContainer;var c=a.endContainer,e=$(b).closest(".essayMathjax"),f=$(c).closest(".essayMathjax");if("essayMathjax"==b.className||
0<e.length)"essayMathjax"==b.className&&(e=b),a.setStartBefore($(e)[0]);if("essayMathjax"==c.className||0<f.length)"essayMathjax"==c.className&&(f=b),a.setEndAfter($(f)[0]);b=a.extractContents();d.appendChild(b);a.insertNode(d)}return d}function essayAnnotated(a){removeTmpspans();var b=$(a).closest(".part-response"),b=$(".annotatedPart",$(b));calcPartialScores(a,!0);a="string:"+cleanupEssay(a);$(b).val(a);$(".notation, .essayAnnotation",$(essaySelector)).tooltip()}
function calcPartialScores(a,b){var c=$(a).closest("tr").next("tr").next("tr"),d=0,e="";$(".essayAnnotation",$(a)).each(function(){var a=parseFloat($(this).attr("data-grade"));d+=isNaN(a)?0:a;e+=a+" + "});e=e.substring(0,e.length-2)+" \x3d "+d.toFixed(2);$(".partial-grades",$(c)).html(e);!studentView&&b&&(c=$(a).closest(".qPart").next().find(".editPartGrade"),editPartGrade(c,d.toFixed(2)))}
function essayClicked(a,b){switch(a.which){case 3:var c=getSelectedText();if(c.toString().length>=MIN_ANNOTATION_LENGTH){var d=createSpanOnContextMenu(c);$("#essay-custom-menu").show();$("#essay-custom-menu").css("top",a.pageY+2+"px");$("#essay-custom-menu").css("left",a.pageX+2+"px");$("#essay-custom-menu-highlight").off().on("click",function(){addHighlight(b,d)});$("#essay-custom-menu-annotate").off().on("click",function(){$("#annotation-grade").val("");$("#annotation-comment").val("");$("#addAnnotation").modal("show")});
$("#addAnnotation .btn-default").off().on("click",function(a){addAnnotation(b,d)});$("#addAnnotation .btn-danger").off().on("click",function(a){removeElement(d)})}}}function addKeyword(){var a=$(this).closest(".essayresponse");$("#addKeyword").modal("show");$("#new-keyword").val("");$("#new-synonyms").val("");$(".btn-danger",$("#addKeyword")).off().on("click",cancelKeyword);$(".btn-default",$("#addKeyword")).off().on("click",saveKeyword);editKeywordTable=$(a)}
function saveKeyword(){var a=$("#new-keyword").val();if(a&&""!=a){var b=$("#new-synonyms").val(),c=$(editKeywordTable).find(".essay"),d=$(editKeywordTable).data("new-keywords"),a={keyword:a,synonyms:b};d.push(a);$(editKeywordTable).data("new-keywords",d);$("#addKeyword").modal("hide");displayKeywords();var e=[];e.push(a.keyword.trim());d=a.synonyms;if(""!=d){var f=d.split(",");$.each(f,function(a){e.push(f[a].trim())})}$(c).highlight(e);$(".highlight").off().on("click",removeHighlight);essayAnnotated($(c));
editKeywordTable=null}else $("#addKeyword").modal("hide")}function cancelKeyword(){$("#addKeyword").modal("hide");editKeywordTable=null}
function displayKeywords(){$(".itemResponse .essayresponse").each(function(){var a=$(this).data("keywords"),b=$(this).data("new-keywords"),c=_.union(a,b);if(0<c.length){var d="\x3cul\x3e";$.each(c,function(a){c[a].keyword&&(d+='\x3cli\x3e\x3cspan class\x3d"kw-syns"\x3e\x3cspan class\x3d"keyword"\x3e'+c[a].keyword+"\x3c/span\x3e:",a=c[a].synonyms,""!=a&&(d+='\x26nbsp;\x3cspan class\x3d"synonyms"\x3e'+a.split(",").join(" ")+"\x3c/span\x3e"),d+="\x3c/span\x3e\x3c/li\x3e")});d+="\x3c/ul\x3e";$(".keywords",
this).html(d);$(".keywords",this).show()}else $(".keywords",this).hide()})}function highlightResponse(a){$(".itemResponse .essayresponse").each(function(){var b=this,c=$(b).data("keywords");$.each(c,function(d){var e=[];e.push(c[d].keyword.trim());d=c[d].synonyms;if(""!=d){var f=d.split(",");$.each(f,function(a){e.push(f[a].trim())})}a?(d="highlight "+a,$(".essay",b).highlight(e,{className:d})):$(".essay",b).highlight(e)})});$(".highlight").off().on("click",removeHighlight)}
function editQuestionGrade(){var a=$(this),a=$(a).closest(".qgTable"),b=$(".editQGrade",$(a)).show();$(".editQComment",$(a)).hide();$(".editQ",$(a)).show();$(".grade",$(b)).trigger("focus");$(".closeDiv",$(b)).off().on("click",function(){$(b).hide();$(".editQ").hide()})}
function editQuestionComment(){var a=$(this),a=$(a).closest(".qgTable"),b=$(".editQComment",$(a)).show();$(".editQGrade",$(a)).hide();$(".editQ",$(a)).show();$(".comment",$(b)).trigger("focus");$(".closeDiv",$(b)).off().on("click",function(){$(b).hide();$(".editQ").hide()})}function regradeQuestion(a){action("Regrade","questionUid\x3d"+$(a.target).data("questionuid")+"\x26answerSheetItemId\x3d"+$(a.target).data("answersheetitemid")+"\x26questionId\x3d"+$(a.target).data("questionid"))}
function editPartGrade(a,b){var c=$(a).parent(".all-part-grades"),d=$(c).next(),e=$("input.editGrade",$(d)),f=$(".savePartGrade",$(d)),g=$(".cancelPartGrade",$(d));$("input.partUpdated",$(d)).val("true");$(f).off().on("click",savePartGrades);$(g).off().on("click",cancelPartGrade);b&&e.val(b);$(c).hide();$(d).show();$(e).trigger("focus")}function cancelPartGrade(){var a=$(this),a=$(a).parent(".edit-part-grade"),b=$(a).prev();$(".partUpdated",$(a)).val("false");$(b).show();$(a).hide();return!1}
function savePartGrades(){var a=$(this).closest(".itemResponse .blanksResponseArea"),b=!0;$(".blanksResponseTable.gradable",$(a)).each(function(){var a=$(this),d=$(".partGrade",$(a)),e=$(".edit-part-grade",$(a));$(e).data("originalgrade");e=Number($(e).data("gradetotal"));a=Number($(".editGrade",$(a)).val())/e;$(d).val(a);1<a&&(b=!1)});b?(a=a.closest(".item").attr("data-position"),updateParts(a)):(new AlertDialogView({model:{body:msgInvalidPartGradeValue}})).render()}
function updateParts(a){if(!$("#form_"+a))return!1;updateGrade(a,"updatePartsGrade")}function updateQuestionComment(a){var b=$("#form_"+a);if(!b)return!1;if(""==$("[name\x3dgrade]",$(b)).val())return alert(msgGradeNotSet),!1;updateGrade(a,"updateQuestionComment")}
function updateGrade(a,b){var c=$("#form_"+a),d=$("#detailView").val(),e=$(".itemResponse :input, .commonInputs :input, .editQGrade :input, .editQComment :input",$(c)).serialize()+"\x26actionId\x3d"+b,e=e+("\x26detailView\x3d"+d),f=document.getElementById("item"+a),g=getBaseURL()+"gradebook/UpdateGradeItem.do",h=[];$(".itemResponse table.essayresponse",$(c)).each(function(){var a=$(this).data("new-keywords");h.push(a)});$.ajax({url:g,data:e,dataType:"text",type:"POST",success:function(a){"manualGrading"!=
d?($(f).html(a),preProcessMathForEssay(f),$(".itemResponse table.essayresponse",$(f)).each(function(){$(this).data("new-keywords",h.shift())}),MathJax.Hub.Queue(["Typeset",MathJax.Hub,f]),init(),loadScannedDocuments(),FF_ASSIGNMENT_REGRADING_V2&&setupRegradeButtons(),0<$(".updateTestGrade",$(f)).length&&($("#asgnDetailTotalScore").html($(".updateTestGrade",$(f)).html()),showGrades())):($("#refreshDetails").data("new-keywords",h.shift()),refreshDetails())}});return!1}
function refreshDetails(){var a=document.createEvent("HTMLEvents");a.initEvent("change",!0,!0);$("#refreshDetails")[0].dispatchEvent(a)}function submit1(){var a=document.getElementById("viewSearchForm");a.action="gradebook/UpdateAllGradeItems.do";a.submit()}function enableComment(a){var b=document.getElementById("grade"+a);a=document.getElementById("text"+a);validateNumber(b)&&b.value?a.disabled=!1:a.disabled=!0}function validateNumber(a){a=getValueFromField(a);return!isNaN(a)}
function getValueFromField(a){var b="";if(null!=a&&0<a.length&&"radio"==a[0].type)for(var c=0;c<a.length;c++){if(0==a[c].disabled&&a[c].checked){b=a[c].value;break}}else if(null!=a&&0==a.disabled){if("hidden"==a.type||"password"==a.type||"text"==a.type||"textarea"==a.type||"radio"==a.type||"file"==a.type)b=a.value;"select-one"==a.type&&(c=a.selectedIndex,0<=c&&(b=a.options[c].value))}return null==b?"":b}
function reverseItems(a){a=document.getElementsByName(a);for(var b=0;b<a.length;b++)a[b].checked=!a[b].checked}
function changeGradeValues(a){var b=document.getElementById("newGradeValue");document.getElementById("newGradeError");if(!validateNumber(b)||0>b.value)return alert(msgInvalidGrade),!1;var c=!1;$(".editQGrade").each(function(){var a=$(this);$(a).data("position");var e=$(a).closest(".qDetailRow"),e=$("input[name\x3dquestions]",$(e));$(e).prop("checked")&&($(a).parent().show(),$(a).show(),$(".closeDiv",$(a)).off().on("click",function(){$(a).hide();$(a).parent().hide()}),$(".grade",$(a)).val(b.value),
c=!0)});c||alert(msgNoGradesSelected)}
var getFormDataObject=function(a){a=$("#form_"+a);a=$(".itemResponse :input, .commonInputs :input, .editQGrade :input",$(a)).serializeArray();for(var b={},c={text:"comment",trId:"testrecordId"},d=0;d<a.length;d++){var e=a[d].name;if(-1<$.inArray(e,["partGrade","annotatedPart","partUpdated"])){var f=e in b?b[e]:[];f.push(a[d].value);b[e]=f}else c[e]?b[c[e]]=a[d].value:b[e]=a[d].value}return b},updateGradeElement=function(a,b){a.find("span.grade-numeric").html(b.grade.toFixed(2)+"/"+b.total.toFixed(2));
a.find("span.grade-letter").html(b.letter);a.find("span.grade-percent").html(b.percent)},hideGradeEdit=function(a){a=a.find("div.editQGrade \x3e button.closeDiv");a.is(":visible")&&a.trigger("click")};
function updateGrades(a){var b="undefined"!=typeof a,c=[],d=!1;2<$($("tr.qDetailRow")[0]).children("td").length&&(d=!0);if(b)c.push(getFormDataObject(a));else if($(".editQGrade").each(function(){var a=$(this).data("position"),d=$(this).closest(".qDetailRow"),d=$("input[name\x3dquestions]",$(d));$(d).prop("checked")&&(c.push(getFormDataObject(a)),b=!0)}),!b){var e=new AlertDialogView({model:{body:msgNoGradesSelected}});e.render();return}var e=function(a){(new AjaxErrorDialogView({model:{request:a}})).render()},
f=function(a){for(var b in a)if(a.hasOwnProperty(b))if("testrecord"==b)updateGradeElement($("#asgnDetailTotalScore"),a[b]),"undefined"!==typeof FF_IMPROVISED_TEST_RECORDS&&hideGradeEdit($('div[id^\x3d"form_total"]'));else{var c=$('div[id^\x3d"form_'+b+'"]');0<c.length&&(updateGradeElement(c.find("div.asgnDetailTotalScore"),a[b]),hideGradeEdit(c),c.find(".gradeOverridden").show(),c.find(".totalGradeComputation").hide())}showGrades()};if("undefined"===typeof FF_IMPROVISED_TEST_RECORDS||"total"!=a){var g;
for(g=0;g<c.length;g++)if(1<c[g].grade){e=new AlertDialogView({model:{body:msgInvalidTotalGradeValue}});e.render();return}}d?$.ajax({type:"POST",url:getBaseURL()+"rest/gradebook/updateTestrecordGrades",datatype:"json",data:{questionItems:JSON.stringify(c)},error:e,success:f}):"undefined"!==typeof FF_IMPROVISED_TEST_RECORDS&&"total"==a?(a=$("#asgnDetailTotalScore").find("span.grade-numeric").html(),$.ajax({type:"POST",url:getBaseURL()+"rest/gradebook/updateTestrecordTotalScore",datatype:"json",data:{testRecordId:$("#viewSearchFormTrId").val(),
newGrade:c[0].grade,assignmentTotal:a.substring(a.indexOf("/")+1)},error:e,success:f})):(a=$("#asgnDetailTotalScore").find("span.grade-numeric").html(),$.ajax({type:"POST",url:getBaseURL()+"rest/gradebook/updateQuestionGrades",datatype:"json",data:{testRecordId:$("#viewSearchFormTrId").val(),questionItems:JSON.stringify(c),assignmentTotal:a.substring(a.indexOf("/")+1)},error:e,success:f}))}
function selectAllQuestions(){var a=$("#selectAllQuestions").prop("checked");$("input[name\x3dquestions]").prop("checked",a)}function showGradeHistory(a,b,c,d){a=getBaseURL()+"gradebook/ViewItemHistory.do?userid\x3d"+a+"\x26trid\x3d"+b+"\x26qnum\x3d"+c+"\x26qweight\x3d"+d;openWindow(a,"historyWindow","height\x3d600,width\x3d800,status\x3dyes,toolbar\x3dno,menubar\x3dno,location\x3dno,resizable\x3dyes,scrollbars\x3dyes");return!1}
function init(){studentView="undefined"!=typeof studentRole?studentRole:!1;$(".addKeyword").hide();$(".editPartGrade").hide();$(".gbkOnly").hide();$(".edit-part-grade").hide();$(".originalResponse .essayAnnotation").removeClass("essayAnnotation");$(".selectResponse input").on("click",function(){var a=$(this).attr("name");$("#annotatedResponse"+a).hide();$("#displayResponse"+a).hide();$("#rawResponse"+a).hide();"annotatedResponse"==$(this).val()?$("#annotatedResponse"+a).show():"displayResponse"==
$(this).val()?$("#displayResponse"+a).show():$("#rawResponse"+a).show()});$(".selectResponse input:first-of-type").trigger("click");$(".itemResponse:not(.gradeFeedback) .essay").each(function(){calcPartialScores(this,!1)});$(".attempt").hide();$(".blanksResponseArea").each(function(){0<$(".attempt",$(this)).length&&$(".toggleAttempts").show()});$(".toggleAttempts").on("click",function(){$(this).closest(".blanksResponseArea").find(".attempt").toggle()});showGrades();replaceComments();displayComments();
if(!studentView){showSymbolBar();$("#selectAllQuestions").off().on("click",selectAllQuestions);$(".editQ").hide();$(".editQGrade").hide();$(".showEditQGrade").off().on("click",editQuestionGrade);$(".editQComment").hide();$(".showEditQComment").off().on("click",editQuestionComment);if(!FF_ASSIGNMENT_REGRADING_V2)$(".regradeQuestion").off().on("click",regradeQuestion);$("#addAnnotation").on("shown.bs.modal",function(){$("#annotation-grade").trigger("focus")});$(".addKeyword").show();$(".addKeyword").off().on("click",
addKeyword);$("#addKeyword").on("shown.bs.modal",function(){$("#new-keyword").trigger("focus")});$(".itemResponse:not(.gradeFeedback) .gbkOnly").show();$(".itemResponse:not(.gradeFeedback) .editPartGrade").show();$(".itemResponse .editPartGrade").on("click",function(){editPartGrade(this);return!1});$(document).on("click",function(){$("#essay-custom-menu").hide();$("#annotation-custom-menu").hide()});$(".itemResponse:not(.gradeFeedback) .essayresponse .essay").off().on("contextmenu",function(a){a.stopPropagation();
a.preventDefault();essayClicked(a,this)});displayKeywords();highlightResponse();$("select[name\x3dgradingStyle]").on("change",showGrades);$(".essayAnnotation").off().on("click",annotationClicked)}$(".notation, .essayAnnotation",$(essaySelector)).tooltip()}function waitInit(){"undefined"!=typeof MathJax?MathJax.Hub.Queue(init):setTimeout(function(){waitInit()},500)}$(function(){waitInit();0<$(".userInfoCell").length&&$("#userData").hide()});
$("#deleteImprovisedRecord").on("click",function(){action("Class","deleteImprovisedRecord\x3dtrue")});