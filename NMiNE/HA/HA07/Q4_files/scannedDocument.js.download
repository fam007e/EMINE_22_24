function generateAndDisplayDocumentId(){if(firstClick("")){$("body").css("cursor","wait");var a=getBaseURL()+"contentmanager/GenerateScannedDocumentId.do",c=this,b="questionIndex\x3d"+$(c).attr("name");0<$("[name\x3dassignment_mode]").length&&(b+="\x26assignment_mode\x3d"+$("[name\x3dassignment_mode]").val());0<$("[name\x3dtestId]").length&&(b+="\x26testId\x3d"+$("[name\x3dtestId]").val());0<$("[name\x3dcurrPage]").length&&(b+="\x26currPage\x3d"+$("[name\x3dcurrPage]").val());0<$("[name\x3dquestionDefinition]").length&&
(b+="\x26"+$("[name\x3dquestionDefinition]").serialize());var d=$(this).data("part");""!=d&&(b+="\x26part\x3d"+d);$.ajax({type:"POST",url:a,data:b,dataType:"html",error:function(a){$("body").css("cursor","auto")},success:function(a){var b=$(c).parent(),d=$("div[name^\x3ddisplayScannedDocumentId]",$(b));$(".scanneddocument",$(b)).data("documentid",a);$(".scannedDocumentId",$(d)).text(a);$(".btn-default",$(d)).on("click",documentIdConfirmed);$(d).modal({backdrop:"static",show:!0});$("body").css("cursor",
"auto")}});clickCounter=0}}function documentIdConfirmed(){var a=$(this).closest("div[name\x3ddisplayScannedDocumentId]");$(".btn-default",$(a)).off("click");var c=$(a).parent(),b=$(".scanneddocument",$(c)),c=$(".btn-scanneddocument",$(c)),d='input[name$\x3d"'+a.data("position")+'.value"]',d=$(d),e=$(b).data("documentid");d.val(e);$(b).text(e);$(b).removeClass("hidden");$(c).replaceWith("");$(a).modal("hide");loadScannedDocument($(b))}
function loadScannedDocuments(){$(".scanneddocument").each(function(){loadScannedDocument(this)})}
function loadScannedDocument(a){var c=$(a).data("documentid")+"";$(a).parent("div");var b=getBaseURL()+"rest/scanneddocuments/find";$.ajax({type:"POST",url:b,data:c,contentType:"application/json",dataType:"text"}).done(function(b){if(b){var e=getBaseURL()+b;b=b.split("/").pop();e='\x3ca class\x3d"btn btn-primary btn-scanned-document" target\x3d"_blank" href\x3d"'+e+'" title\x3d"'+c+'"\x3e'+b+"\x3c/a\x3e";$(a).replaceWith(e)}})}
function scannedDocumentFileUpload(a,c,b){$.ajax({url:a,type:"POST",data:c,async:!1,cache:!1,contentType:!1,processData:!1,success:function(a){b(a)}})}
function checkFileExtension(){var a=$(this),c=$(a).closest(".sdFileContainer"),b=$(a).val().split(".").pop().toLowerCase();if(b){if((a=$(a).data("extensions"))&&0<a.length){for(var d=!1,e=a.split(","),f=0;f<e.length;f++)if(b==e[f]){d=!0;break}if(!d)return(new AlertDialogView({model:{body:msgFileExtensionError+" "+a}})).render(),$(this).val(""),!1}$(".uploadScannedDoc",$(c)).prop("disabled",!1);$(".uploadScannedDoc",$(c)).addClass("btn-primary")}}
function initDocumentUpload(){$(".choose_scanneddoc").on("change",checkFileExtension);$("div.uploadDocumentFormContainer [name\x3dfileUploaded]").each(function(){var a=$(this).closest(".uploadDocumentFormContainer");"true"==$(this).val()?($(".sdFileContainer",$(a)).hide(),$(".sdButtonContainer",$(a)).show(),$(".sdRefreshContainer",$(a)).show()):($(".sdButtonContainer",$(a)).hide(),$(".sdRefreshContainer",$(a)).hide())});$(".showUploadcontainer").on("click",function(){var a=$(this),a=$(a).closest(".uploadDocumentFormContainer");
$(".sdFileContainer",$(a)).show();$(".sdButtonContainer",$(a)).hide();$(".sdRefreshContainer",$(a)).hide()});$("div.uploadDocumentFormContainer .uploadDocument").on("click",function(){var a=$(this),c=$(a).closest(".uploadDocumentFormContainer"),b=document.forms.edu_form,a=new FormData;a.append("actionId","uploadDocumentAjax");a.append("assignment_mode",$('input[name\x3d"assignment_mode"]',$(b)).val());a.append("testId",$("input[name\x3dtestId]",$(b)).val());a.append("currPage",$("input[name\x3dcurrPage]",
$(b)).val());a.append("part",$("input[name\x3dpart]",$(c)).val());a.append("fileExtensions",$("input[name\x3dfileExtensions]",$(c)).val());a.append("questionIndex",$("input[name\x3dquestionIndex]",$(c)).val());a.append("uploadFile",$("input[type\x3dfile]",$(c))[0].files[0]);b=getBaseURL()+"contentmanager/DocumentUpload.do";scannedDocumentFileUpload(b,a,function(a){if("no_sheet"==a.result){var b='\x3cspan class\x3d"btn btn-primary "\x3e'+msgNoDocumentUploaded+"\x3c/span\x3e";$(".sdFileContainer",$(c)).hide();
$(".sdFileButton",$(c)).html(b);$(".sdButtonContainer",$(c)).show();$(".sdRefreshContainer",$(c)).show()}else"error"==a.result?(new ErrorDialogView({model:{error:a.error}})).render():(b='\x3ca class\x3d"btn btn-primary " target\x3d"_blank" href\x3d"'+a.path+'" title\x3d"'+a.filename+'"\x3e'+a.filename+"\x3c/a\x3e",$('[name$\x3d".value"]',$(c)).val(a.id),$(".sdFileContainer",$(c)).hide(),$(".sdFileButton",$(c)).html(b),$(".sdButtonContainer",$(c)).show(),$(".sdRefreshContainer",$(c)).show())});return!1})}
$(function(){$(".btn-scanneddocument").on("click",generateAndDisplayDocumentId);loadScannedDocuments();initDocumentUpload()});